<body style="background-color: rgb(250, 250, 250);">

</body>

<script src="..\biblio\p5.min.js"></script>

<script>

const taille = [350,641];

const ec = 2;
const rayon = 3;
const size = 28;
const dim_tetris = [10,20];
const dep_pos = [taille[0]/2-(ec*(dim_tetris[0]-1)+size*dim_tetris[0])/2,taille[1]/2-(ec*(dim_tetris[1]-1)+size*dim_tetris[1])/2];

const default_case_color = [255,255,255];
const default_carre_color = [12,12,60];
const default_bar_color = [255,201,14];
const default_lobject_color = [255,2,74];
const default_oobject_color = [240,20,47];
const default_sobject_color = [60,55,47];
const default_zobject_color = [100,75,160];
const default_invtobject_color = [75,75,16];

</script>

<script>

class Case {

    constructor(x,y,size,color,rd,nbr_col,nbr_lg) {

        this.x = x;
        this.y = y;
        this.nbr_col = nbr_col;
        this.nbr_lg = nbr_lg;
        this.size = size;
        this.color = color;
        this.rounded = rd;
        this.isTaken = false;
        this.tkBy = null;

    }

    getInfos() {

        return [this.x,this.y,this.size,this.color];

    }

}

class Carre{

    constructor(positions,color=default_carre_color){

        this.cases = positions;
        this.colors = color;

    }

    plantGrownd(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = this.colors;
            this.cases[i].isTaken = true;
            this.cases[i].tkBy = this;

        }

    }

    reset(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = default_case_color;
            this.cases[i].isTaken = false;

        }

    }

    moveEnBas(){

        let cases_les_plus_bas = [];

        for(let i=0;i<this.cases.length;i++){

            if (cases_les_plus_bas.length!=0){

                if(this.cases[i].nbr_lg>cases_les_plus_bas[0].nbr_lg){

                    cases_les_plus_bas = [this.cases[i]]

                } else if(this.cases[i].nbr_lg==cases_les_plus_bas[0].nbr_lg){

                    cases_les_plus_bas.push(this.cases[i])

                }

            } else {

                cases_les_plus_bas.push(this.cases[i])

            }

        }

        let can_move = true;

        for(var i=0;i<cases_les_plus_bas.length;i++){

            const case_suiv = getCaseByNbr(cases_les_plus_bas[i].nbr_col,cases_les_plus_bas[i].nbr_lg+1,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    can_move = false;

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object));
                

            }

            this.reset()

            this.cases = new_position;

        }

        return can_move;
        
    }

    moveEnLeft(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    moveEnRight(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

}

class Bar{

    constructor(positions,color=default_bar_color,shape){

        this.cases = positions;
        this.colors = color;
        this.type = shape;
        this.typeMax = 3

    }

    plantGrownd(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = this.colors;
            this.cases[i].isTaken = true;
            this.cases[i].tkBy = this;

        }

    }

    reset(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = default_case_color;
            this.cases[i].isTaken = false;
            this.cases[i].tkBy = null;

        }

    }

    moveEnBas(){

        let cases_les_plus_bas = [];

        for(let i=0;i<this.cases.length;i++){

            if (cases_les_plus_bas.length!=0){

                if(this.cases[i].nbr_lg>cases_les_plus_bas[0].nbr_lg){

                    cases_les_plus_bas = [this.cases[i]]

                } else if(this.cases[i].nbr_lg==cases_les_plus_bas[0].nbr_lg){

                    cases_les_plus_bas.push(this.cases[i])

                }

            } else {

                cases_les_plus_bas.push(this.cases[i])

            }

        }

        let can_move = true;

        for(var i=0;i<cases_les_plus_bas.length;i++){

            const case_suiv = getCaseByNbr(cases_les_plus_bas[i].nbr_col,cases_les_plus_bas[i].nbr_lg+1,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    can_move = false;

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object));
                

            }

            this.reset()

            this.cases = new_position;

        }

        return can_move;
        
    }

    moveEnLeft(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

}

    moveEnRight(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    makeRotation(type){

        if(type==1 && this.type==0){
            
            this.cases.sort(function(x,y){

                if(x.nbr_col<y.nbr_col){

                    return -1;

                }

                if(x.nbr_col>y.nbr_col){

                    return 1;

                }

                return 0;

            });

            const element_of_new_type = this.cases[2];
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+2,all_cases_object)];

            let transformeable = true

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            //console.log("nope",new_pos[i])
                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = 1;

                //this.plantGrownd();

            }

        } else if(type==2 && this.type==1){

            this.cases.sort(function(x,y){

                if(x.nbr_lg<y.nbr_lg){

                    return -1;

                }

                if(x.nbr_lg>y.nbr_lg){

                    return 1;

                }

                return 0;

            });

            const element_of_new_type = this.cases[2];
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-2,element_of_new_type.nbr_lg,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object)];

            let transformeable = true

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            //console.log("nope",new_pos[i])
                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = 2;

                this.plantGrownd();

            }

        } else if(type==3 && this.type==2){

            this.cases.sort(function(x,y){

                if(x.nbr_col<y.nbr_col){

                    return -1;

                }

                if(x.nbr_col>y.nbr_col){

                    return 1;

                }

                return 0;

            });

            const element_of_new_type = this.cases[1];

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-2,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object)];

            let transformeable = true

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            //console.log("nope",new_pos[i])
                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = 3

                this.plantGrownd();

            }

        }

        else if(type==0 && this.type==3){

            this.cases.sort(function(x,y){

                if(x.nbr_lg<y.nbr_lg){

                    return -1;

                }

                if(x.nbr_lg>y.nbr_lg){

                    return 1;

                }

                return 0;

            });

            const element_of_new_type = this.cases[1];

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col+2,element_of_new_type.nbr_lg,all_cases_object)];

            let transformeable = true

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            //console.log("nope",new_pos[i])
                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = 0

                this.plantGrownd();

            }

        }

    }


}

class Lobject{

    constructor(positions,color=default_lobject_color,shape){

        this.cases = positions;
        this.colors = color;
        this.type = shape;
        this.typeMax = 3;

    }

    plantGrownd(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = this.colors;
            this.cases[i].isTaken = true;
            this.cases[i].tkBy = this;

        }

    }

    reset(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = default_case_color;
            this.cases[i].isTaken = false;
            this.cases[i].tkBy = null;

        }

    }

    moveEnBas(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true && case_suiv.tkBy!=this){

                    can_move = false;

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object));
                

            }

            this.reset()

            this.cases = new_position;

        }

        return can_move;

    }

    moveEnLeft(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    moveEnRight(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    makeRotation(type){

        if(type==1 && this.type==0){

            let le_plus_haut = null;

            for(var i=0;i<this.cases.length;i++){

                if(le_plus_haut==null){

                    le_plus_haut = this.cases[i];

                } else if(le_plus_haut.nbr_lg>this.cases[i].nbr_lg){

                    le_plus_haut = this.cases[i];

                }

            }

            let first_el = this.cases[0];
            this.cases[this.cases.indexOf(le_plus_haut)] = first_el;
            this.cases[0] = le_plus_haut;

            this.cases.shift();

            this.cases.sort(function(x,y){

                if(x.nbr_col<y.nbr_col){

                    return -1;

                }

                if(x.nbr_col>y.nbr_col){

                    return 1;

                }

                return 0;

            });

            this.cases.unshift(le_plus_haut);

            const element_of_new_type = this.cases[2];
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg-1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object)];

            let transformeable = true;

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = type;

                this.plantGrownd();

            }


        } else if(type==2 && this.type==1){

            let le_plus_right = null;

            for(var i=0;i<this.cases.length;i++){

                if(le_plus_right==null){

                    le_plus_right = this.cases[i];

                } else if(le_plus_right.nbr_col<this.cases[i].nbr_col){

                    le_plus_right = this.cases[i];

                }

            }

            let first_el = this.cases[0];
            this.cases[this.cases.indexOf(le_plus_right)] = first_el;
            this.cases[0] = le_plus_right;

            this.cases.shift();

            this.cases.sort(function(x,y){

                if(x.nbr_lg<y.nbr_lg){

                    return -1;

                }

                if(x.nbr_lg>y.nbr_lg){

                    return 1;

                }

                return 0;

            });

            this.cases.unshift(le_plus_right);

            const element_of_new_type = this.cases[2];
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg+1,all_cases_object)];

            let transformeable = true

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            //console.log("nope",new_pos[i])
                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = type;

                this.plantGrownd();

            }

        } else if(type==3 && this.type==2){

            this.cases.sort(function(x,y){

                if(x.nbr_col<y.nbr_col){

                    return -1;

                }

                if(x.nbr_col>y.nbr_col){

                    return 1;

                }

                return 0;

            });

            const element_of_new_type = this.cases[1];

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg+1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object)];

            let transformeable = true

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = type;

                this.plantGrownd();

            }

        } else if(type==0 && this.type==3){

            let le_plus_left = null;

            for(var i=0;i<this.cases.length;i++){

                if(le_plus_left==null){

                    le_plus_left = this.cases[i];

                } else if(le_plus_left.nbr_col>this.cases[i].nbr_col){

                    le_plus_left = this.cases[i];

                }

            }

            let first_el = this.cases[0];
            this.cases[this.cases.indexOf(le_plus_left)] = first_el;
            this.cases[0] = le_plus_left;

            this.cases.shift();

            this.cases.sort(function(x,y){

                if(x.nbr_lg>y.nbr_lg){

                    return -1;

                }

                if(x.nbr_lg<y.nbr_lg){

                    return 1;

                }

                return 0;

            });

            this.cases.unshift(le_plus_left);

            const element_of_new_type = this.cases[2];

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg-1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object)];

            let transformeable = true

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            //console.log("nope",new_pos[i])
                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = type;

                this.plantGrownd();

            }

        }

    } 

}

class Oobject{

    constructor(positions,color=default_oobject_color,shape){

        this.cases = positions;
        this.colors = color;
        this.type = shape;
        this.typeMax = 3;

    }

    plantGrownd(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = this.colors;
            this.cases[i].isTaken = true;
            this.cases[i].tkBy = this;

        }

    }

    reset(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = default_case_color;
            this.cases[i].isTaken = false;
            this.cases[i].tkBy = null;

        }

    }

    moveEnBas(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true && case_suiv.tkBy!=this){

                    can_move = false;

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object));
                

            }

            this.reset()

            this.cases = new_position;

        }

        return can_move;

    }

    moveEnLeft(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    moveEnRight(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    makeRotation(type){

        if(type==1 && this.type==0){

            let le_plus_haut = null;

            for(var i=0;i<this.cases.length;i++){

                if(le_plus_haut==null){

                    le_plus_haut = this.cases[i];

                } else if(le_plus_haut.nbr_lg>this.cases[i].nbr_lg){

                    le_plus_haut = this.cases[i];

                }

            }

            let first_el = this.cases[0];
            this.cases[this.cases.indexOf(le_plus_haut)] = first_el;
            this.cases[0] = le_plus_haut;

            this.cases.shift();

            this.cases.sort(function(x,y){

                if(x.nbr_col<y.nbr_col){

                    return -1;

                }

                if(x.nbr_col>y.nbr_col){

                    return 1;

                }

                return 0;

            });

            this.cases.unshift(le_plus_haut);

            const element_of_new_type = this.cases[2];
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg+1,all_cases_object)];

            let transformeable = true;

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = type;

                this.plantGrownd();

            }


        } else if(type==2 && this.type==1){

            let le_plus_right = null;

            for(var i=0;i<this.cases.length;i++){

                if(le_plus_right==null){

                    le_plus_right = this.cases[i];

                } else if(le_plus_right.nbr_col<this.cases[i].nbr_col){

                    le_plus_right = this.cases[i];

                }

            }

            let first_el = this.cases[0];
            this.cases[this.cases.indexOf(le_plus_right)] = first_el;
            this.cases[0] = le_plus_right;

            this.cases.shift();

            this.cases.sort(function(x,y){

                if(x.nbr_lg<y.nbr_lg){

                    return -1;

                }

                if(x.nbr_lg>y.nbr_lg){

                    return 1;

                }

                return 0;

            });

            this.cases.unshift(le_plus_right);

            const element_of_new_type = this.cases[2];
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg+1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object)];

            let transformeable = true

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            //console.log("nope",new_pos[i])
                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = type;

                this.plantGrownd();

            }

        } else if(type==3 && this.type==2){

            this.cases.sort(function(x,y){

                if(x.nbr_col>y.nbr_col){

                    return -1;

                }

                if(x.nbr_col<y.nbr_col){

                    return 1;

                }

                return 0;

            });

            const element_of_new_type = this.cases[1];

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg-1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object)];

            let transformeable = true

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = type;

                this.plantGrownd();

            }

        } else if(type==0 && this.type==3){

            let le_plus_left = null;

            for(var i=0;i<this.cases.length;i++){

                if(le_plus_left==null){

                    le_plus_left = this.cases[i];

                } else if(le_plus_left.nbr_col>this.cases[i].nbr_col){

                    le_plus_left = this.cases[i];

                }

            }

            let first_el = this.cases[0];
            this.cases[this.cases.indexOf(le_plus_left)] = first_el;
            this.cases[0] = le_plus_left;

            this.cases.shift();

            this.cases.sort(function(x,y){

                if(x.nbr_lg<y.nbr_lg){

                    return -1;

                }

                if(x.nbr_lg>y.nbr_lg){

                    return 1;

                }

                return 0;

            });

            this.cases.unshift(le_plus_left);

            const element_of_new_type = this.cases[2];

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg-1,all_cases_object)];

            let transformeable = true

            for(var i=0;i<new_pos.length;i++){

                if(new_pos[i]!=null){

                    if(new_pos[i].isTaken!=false){

                        if(new_pos[i].tkBy!=this){

                            //console.log("nope",new_pos[i])
                            transformeable = false;

                        }

                    }

                } else {

                    transformeable = false;

                }

            }

            if(transformeable){

                this.reset()

                this.cases = new_pos;

                this.type = type;

                this.plantGrownd();

            }

        }

    }

}

class Sobject{

    constructor(positions,color=default_sobject_color,shape){

        this.cases = positions;
        this.colors = color;
        this.type = shape;
        this.typeMax = 3;

    }

    plantGrownd(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = this.colors;
            this.cases[i].isTaken = true;
            this.cases[i].tkBy = this;

        }

    }

    reset(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = default_case_color;
            this.cases[i].isTaken = false;
            this.cases[i].tkBy = null;

        }

    }

    moveEnBas(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true && case_suiv.tkBy!=this){

                    can_move = false;
                    print("noo")
                    print(case_suiv)

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object));
                

            }

            this.reset()

            this.cases = new_position;

        }

        return can_move;

    }

    moveEnLeft(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    moveEnRight(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    getPivotFromType(type){

        if(type==0){

            this.cases.sort(function(x,y){

                if(x.nbr_col<y.nbr_col){

                    return -1;

                }

                if(x.nbr_col>y.nbr_col){

                    return 1;

                }

                if(x.nbr_col==y.nbr_col){

                    if(x.nbr_lg>y.nbr_lg){

                        return -1;

                    } 

                    if(x.nbr_lg<y.nbr_lg){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[1];
            
        } 
        
        else if(type==1){

            this.cases.sort(function(x,y){

                if(x.nbr_lg<y.nbr_lg){

                    return -1;

                }

                if(x.nbr_lg>y.nbr_lg){

                    return 1;

                }

                if(x.nbr_lg==y.nbr_lg){

                    if(x.nbr_col<y.nbr_col){

                        return -1;

                    } 

                    if(x.nbr_col>y.nbr_col){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[1];

        }

        else if(type==2){

            this.cases.sort(function(x,y){

                if(x.nbr_col>y.nbr_col){

                    return -1;

                }

                if(x.nbr_col<y.nbr_col){

                    return 1;

                }

                if(x.nbr_col==y.nbr_col){

                    if(x.nbr_lg<y.nbr_lg){

                        return -1;

                    } 

                    if(x.nbr_lg>y.nbr_lg){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[1];

        }

        else if(type==3){

            this.cases.sort(function(x,y){

                if(x.nbr_col>y.nbr_col){

                    return -1;

                }

                if(x.nbr_col<y.nbr_col){

                    return 1;

                }

                if(x.nbr_col==y.nbr_col){

                    if(x.nbr_lg<y.nbr_lg){

                        return -1;

                    } 

                    if(x.nbr_lg>y.nbr_lg){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[0];

        }

    }

    applyNewPos(n_pos,draw,type_sp){

        let transformeable = true;

        for(var i=0;i<n_pos.length;i++){

            if(n_pos[i]!=null){

                if(n_pos[i].isTaken!=false){

                    if(n_pos[i].tkBy!=this){

                        transformeable = false;

                    }

                }

            } else {

                transformeable = false;

            }

        }

        if(transformeable){

            this.reset()

            this.cases = n_pos;

            this.type = type_sp;

            if(draw){

                this.plantGrownd();

            }
            
        }

        return transformeable;

    }

    makeRotation(type){

        if(type==1 && this.type==0){

            const element_of_new_type = this.getPivotFromType(this.type);

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg+1,all_cases_object)];

            this.applyNewPos(new_pos,true,type);


        } else if(type==2 && this.type==1){

            const element_of_new_type = this.getPivotFromType(this.type);
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg+1,all_cases_object)];

            this.applyNewPos(new_pos,true,type);

        } else if(type==3 && this.type==2){

            const element_of_new_type = this.getPivotFromType(this.type);
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg-1,all_cases_object)];

            this.applyNewPos(new_pos,true,type);

        } else if(type==0 && this.type==3){

            const element_of_new_type = this.getPivotFromType(this.type);

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg-1,all_cases_object)];

            this.applyNewPos(new_pos,true,type);

        }

    }

}

class Zobject{
    
    constructor(positions,color=default_zobject_color,shape){

        this.cases = positions;
        this.colors = color;
        this.type = shape;
        this.typeMax = 3;

    }

    plantGrownd(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = this.colors;
            this.cases[i].isTaken = true;
            this.cases[i].tkBy = this;

        }

    }

    reset(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = default_case_color;
            this.cases[i].isTaken = false;
            this.cases[i].tkBy = null;

        }

    }

    moveEnBas(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true && case_suiv.tkBy!=this){

                    can_move = false;
        
                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object));
                

            }

            this.reset()

            this.cases = new_position;

        }

        return can_move;

    }

    moveEnLeft(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    moveEnRight(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    getPivotFromType(type){

        if(type==0){

            this.cases.sort(function(x,y){

                if(x.nbr_col<y.nbr_col){

                    return -1;

                }

                if(x.nbr_col>y.nbr_col){

                    return 1;

                }

                if(x.nbr_col==y.nbr_col){

                    if(x.nbr_lg>y.nbr_lg){

                        return -1;

                    } 

                    if(x.nbr_lg<y.nbr_lg){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[1];
            
        } 

        else if(type==1){

            this.cases.sort(function(x,y){

                if(x.nbr_lg>y.nbr_lg){

                    return -1;

                }

                if(x.nbr_lg<y.nbr_lg){

                    return 1;

                }

                if(x.nbr_lg==y.nbr_lg){

                    if(x.nbr_col<y.nbr_col){

                        return -1;

                    } 

                    if(x.nbr_col>y.nbr_col){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[1];

        }

        else if(type==2){

            this.cases.sort(function(x,y){

                if(x.nbr_col>y.nbr_col){

                    return -1;

                }

                if(x.nbr_col<y.nbr_col){

                    return 1;

                }

                if(x.nbr_col==y.nbr_col){

                    if(x.nbr_lg<y.nbr_lg){

                        return -1;

                    } 

                    if(x.nbr_lg>y.nbr_lg){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[1];

        }

        else if(type==3){

            this.cases.sort(function(x,y){

                if(x.nbr_col>y.nbr_col){

                    return -1;

                }

                if(x.nbr_col<y.nbr_col){

                    return 1;

                }

                if(x.nbr_col==y.nbr_col){

                    if(x.nbr_lg<y.nbr_lg){

                        return -1;

                    } 

                    if(x.nbr_lg>y.nbr_lg){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[1];

        }

    }

    applyNewPos(n_pos,draw,type_sp){

        let transformeable = true;

        for(var i=0;i<n_pos.length;i++){

            if(n_pos[i]!=null){

                if(n_pos[i].isTaken!=false){

                    if(n_pos[i].tkBy!=this){

                        transformeable = false;

                    }

                }

            } else {

                transformeable = false;

            }

        }

        if(transformeable){

            this.reset()

            this.cases = n_pos;

            this.type = type_sp;

            if(draw){

                this.plantGrownd();

            }
            
        }

        return transformeable;

    }

    makeRotation(type){

        if(type==1 && this.type==0){

            const element_of_new_type = this.getPivotFromType(this.type);

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg-1,all_cases_object)];

            this.applyNewPos(new_pos,true,type);


        } else if(type==2 && this.type==1){

            const element_of_new_type = this.getPivotFromType(this.type);
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg+1,all_cases_object)];

            this.applyNewPos(new_pos,true,type);

        } else if(type==3 && this.type==2){

            const element_of_new_type = this.getPivotFromType(this.type);
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg+1,all_cases_object)];

            this.applyNewPos(new_pos,true,type);

        } else if(type==0 && this.type==3){

            const element_of_new_type = this.getPivotFromType(this.type);

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg-1,all_cases_object)];

            this.applyNewPos(new_pos,true,type);

        }

    }

}

class InvTobject{

    constructor(positions,color=default_invtobject_color,shape){

        this.cases = positions;
        this.colors = color;
        this.type = shape;
        this.typeMax = 3;

    }

    plantGrownd(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = this.colors;
            this.cases[i].isTaken = true;
            this.cases[i].tkBy = this;

        }

    }

    reset(){

        for(let i=0;i<this.cases.length;i++){

            this.cases[i].color = default_case_color;
            this.cases[i].isTaken = false;
            this.cases[i].tkBy = null;

        }

    }

    moveEnBas(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true && case_suiv.tkBy!=this){

                    can_move = false;

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col,this.cases[i].nbr_lg+1,all_cases_object));
                

            }

            this.reset()

            this.cases = new_position;

        }

        return can_move;

    }

    moveEnLeft(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col-1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    moveEnRight(){

        let can_move = true;

        for(var i=0;i<this.cases.length;i++){

            const case_suiv = getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object);

            if(case_suiv!=null){

                if(case_suiv.isTaken===true){

                    if(case_suiv.tkBy!=this){
                    
                        can_move = false;
                        break;

                    }

                }

            } else {

                can_move = false;
                break;

            }

        }

        if(can_move){

            var new_position = [];
            
            for(var i=0;i<this.cases.length;i++){

                new_position.push(getCaseByNbr(this.cases[i].nbr_col+1,this.cases[i].nbr_lg,all_cases_object));
                
            }

            this.reset()

            this.cases = new_position;

        }

    }

    getPivotFromType(type){

        if(type==0){

            this.cases.sort(function(x,y){

                if(x.nbr_col<y.nbr_col){

                    return -1;

                }

                if(x.nbr_col>y.nbr_col){

                    return 1;

                }

                if(x.nbr_col==y.nbr_col){

                    if(x.nbr_lg>y.nbr_lg){

                        return -1;

                    } 

                    if(x.nbr_lg<y.nbr_lg){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[1];
            
        } 

        else if(type==1){

            this.cases.sort(function(x,y){

                if(x.nbr_lg<y.nbr_lg){

                    return -1;

                }

                if(x.nbr_lg>y.nbr_lg){

                    return 1;

                }

                if(x.nbr_lg==y.nbr_lg){

                    if(x.nbr_col<y.nbr_col){

                        return -1;

                    } 

                    if(x.nbr_col>y.nbr_col){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[1];

        }

        else if(type==2){

            this.cases.sort(function(x,y){

                if(x.nbr_col<y.nbr_col){

                    return -1;

                }

                if(x.nbr_col>y.nbr_col){

                    return 1;

                }

                if(x.nbr_col==y.nbr_col){

                    if(x.nbr_lg<y.nbr_lg){

                        return -1;

                    } 

                    if(x.nbr_lg>y.nbr_lg){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[1];

        }

        else if(type==3){

            this.cases.sort(function(x,y){

                if(x.nbr_lg<y.nbr_lg){

                    return -1;

                }

                if(x.nbr_lg>y.nbr_lg){

                    return 1;

                }

                if(x.nbr_lg==y.nbr_lg){

                    if(x.nbr_col>y.nbr_col){

                        return -1;

                    } 

                    if(x.nbr_lg<y.nbr_lg){

                        return 1;

                    }

                    return 0;

                }

            });

            return this.cases[1];

        }

    }

    applyNewPos(n_pos,draw,type_sp){

        let transformeable = true;

        for(var i=0;i<n_pos.length;i++){

            if(n_pos[i]!=null){

                if(n_pos[i].isTaken!=false){

                    if(n_pos[i].tkBy!=this){

                        transformeable = false;

                    }

                }

            } else {

                transformeable = false;

            }

        }

        if(transformeable){

            this.reset()

            this.cases = n_pos;

            this.type = type_sp;

            if(draw){

                this.plantGrownd();

            }
            
        }

        return transformeable;

    }

    makeRotation(type){

        if(type==1 && this.type==0){

            const element_of_new_type = this.getPivotFromType(this.type);

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object)];

            this.applyNewPos(new_pos,true,type);


        } else if(type==2 && this.type==1){

            const element_of_new_type = this.getPivotFromType(this.type);
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object)];

            this.applyNewPos(new_pos,true,type);

        } else if(type==3 && this.type==2){

            const element_of_new_type = this.getPivotFromType(this.type);
            
            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg+1,all_cases_object)];

            this.applyNewPos(new_pos,true,type);

        } else if(type==0 && this.type==3){

            const element_of_new_type = this.getPivotFromType(this.type);

            var new_pos = [getCaseByNbr(element_of_new_type.nbr_col-1,element_of_new_type.nbr_lg,all_cases_object),element_of_new_type,getCaseByNbr(element_of_new_type.nbr_col,element_of_new_type.nbr_lg-1,all_cases_object),getCaseByNbr(element_of_new_type.nbr_col+1,element_of_new_type.nbr_lg,all_cases_object)];

            this.applyNewPos(new_pos,true,type);

        }

    }

}

function changeRot(){

    if(invTobject.type==3){

        invTobject.makeRotation(0)

    } else {

        invTobject.makeRotation(invTobject.type+1)

    }

    invTobject.plantGrownd()

}

function getCaseByNbr(nbr_col,nbr_lg,cases){

    if((nbr_col>0 && nbr_col<=10) && (nbr_lg>0 && nbr_col<=20)){

        const case_nbr = (nbr_lg-1)*10+(nbr_col-1);

        if(case_nbr<cases.length){

            return cases[case_nbr];

        } 

    }

    return null;

}


</script>

<script>

    var all_cases_object = [];

    var obj_move = null;

    var lobject = null;
    var carre2 = null;
    var oobject = null;
    var sobject = null;
    var zobject = null;
    var invTobject = null;

    function generateCases(x,y,ec,r,w_h,quant){

        for(var i = 0;i<quant[1];i++){

            for(var j = 0;j<quant[0];j++){

                const act_case = [x*(1)+(ec+w_h)*j,y*(1)+(ec+w_h)*i,r,w_h];

                all_cases_object.push(new Case(act_case[0],act_case[1],act_case[3],default_case_color,r,j+1,i+1))

            }

        }

    }

    function descendreObj(){

        let obj_stat = obj_move.moveEnBas();
        obj_move.plantGrownd();

        if(obj_stat===false){

            obj_move = generateRandomPiece();
            obj_move.plantGrownd();

        }

    }

    function generateCarrePos(first_carre_pos = [5,1]){

        return [getCaseByNbr(first_carre_pos[0],first_carre_pos[1],all_cases_object),getCaseByNbr(first_carre_pos[0]+1,first_carre_pos[1],all_cases_object),getCaseByNbr(first_carre_pos[0],first_carre_pos[1]+1,all_cases_object),getCaseByNbr(first_carre_pos[0]+1,first_carre_pos[1]+1,all_cases_object)];

    }

    function generateBarPoss(first_case_pos = [6,1]){

        return [getCaseByNbr(first_case_pos[0],first_case_pos[1],all_cases_object),getCaseByNbr(first_case_pos[0],first_case_pos[1]+1,all_cases_object),getCaseByNbr(first_case_pos[0],first_case_pos[1]+2,all_cases_object),getCaseByNbr(first_case_pos[0],first_case_pos[1]+3,all_cases_object)]

    }

    function generateLPoss(first_case_pos = [5,1]){

        return [getCaseByNbr(first_case_pos[0],first_case_pos[1],all_cases_object),getCaseByNbr(first_case_pos[0],first_case_pos[1]+1,all_cases_object),getCaseByNbr(first_case_pos[0]+1,first_case_pos[1]+1,all_cases_object),getCaseByNbr(first_case_pos[0]+2,first_case_pos[1]+1,all_cases_object)];

    }

    function generateOPoss(first_case_pos = [7,1]){

        return [getCaseByNbr(first_case_pos[0],first_case_pos[1],all_cases_object),getCaseByNbr(first_case_pos[0],first_case_pos[1]+1,all_cases_object),getCaseByNbr(first_case_pos[0]-1,first_case_pos[1]+1,all_cases_object),getCaseByNbr(first_case_pos[0]-2,first_case_pos[1]+1,all_cases_object)];

    }

    function generateSPoss(first_case_pos = [7,1]){

        return [getCaseByNbr(first_case_pos[0],first_case_pos[1],all_cases_object),getCaseByNbr(first_case_pos[0]-1,first_case_pos[1],all_cases_object),getCaseByNbr(first_case_pos[0]-1,first_case_pos[1]+1,all_cases_object),getCaseByNbr(first_case_pos[0]-2,first_case_pos[1]+1,all_cases_object)];

    }

    function generateZPoss(first_case_pos = [5,1]){

        return [getCaseByNbr(first_case_pos[0],first_case_pos[1],all_cases_object),getCaseByNbr(first_case_pos[0]+1,first_case_pos[1],all_cases_object),getCaseByNbr(first_case_pos[0]+1,first_case_pos[1]+1,all_cases_object),getCaseByNbr(first_case_pos[0]+2,first_case_pos[1]+1,all_cases_object)];

    }

    function generateInvPoss(first_case_pos = [6,1]){

        return [getCaseByNbr(first_case_pos[0],first_case_pos[1],all_cases_object),getCaseByNbr(first_case_pos[0]-1,first_case_pos[1]+1,all_cases_object),getCaseByNbr(first_case_pos[0],first_case_pos[1]+1,all_cases_object),getCaseByNbr(first_case_pos[0]+1,first_case_pos[1]+1,all_cases_object)];

    }

    function generateRandomPiece(){

        const choix =  parseInt(random()*7);
        const the_color = [random(255),random(255),random(255)];

        if(choix==0){

            return new Carre(generateCarrePos(),the_color);

        } else if(choix==1){

            return new Bar(generateBarPoss(),the_color,1);

        } else if(choix==2){

            return new Lobject(generateLPoss(),the_color,0);

        } else if(choix==3){

            return new Oobject(generateOPoss(),the_color,0);

        } else if(choix==4){

            return new Sobject(generateSPoss(),the_color,0);

        } else if(choix==5){

            return new Zobject(generateZPoss(),the_color,0);

        } else if(choix==6){

            return new InvTobject(generateInvPoss(),the_color,0);

        }

    }


    function keyPressed(){

        if(keyCode === CONTROL){

            if(obj_move.type==3){

                obj_move.makeRotation(0)

            } else {

                obj_move.makeRotation(obj_move.type+1)

            }

            obj_move.plantGrownd()

        } else if(keyCode === LEFT_ARROW){

            obj_move.reset();
            obj_move.moveEnLeft();
            obj_move.plantGrownd();

        } else if(keyCode === RIGHT_ARROW){

            obj_move.reset();
            obj_move.moveEnRight();
            obj_move.plantGrownd();

        }

    }

    function setup() {

        const cnv = createCanvas(taille[0], taille[1]);
        const x = (windowWidth - width) / 2;
        const y = (windowHeight - height) / 2;
        
        cnv.position(x, y);
        generateCases(dep_pos[0],dep_pos[1],ec,rayon,size,dim_tetris)

        //const pos = [getCaseByNbr(3,4,all_cases_object),getCaseByNbr(3,5,all_cases_object),getCaseByNbr(4,5,all_cases_object),getCaseByNbr(5,5,all_cases_object)];

        //const pos = [getCaseByNbr(3,5,all_cases_object),getCaseByNbr(4,5,all_cases_object),getCaseByNbr(5,5,all_cases_object),getCaseByNbr(6,5,all_cases_object)];

        //const pos = [getCaseByNbr(3,4,all_cases_object),getCaseByNbr(3,5,all_cases_object),getCaseByNbr(2,5,all_cases_object),getCaseByNbr(1,5,all_cases_object)];

        //const pos = [getCaseByNbr(3,4,all_cases_object),getCaseByNbr(4,4,all_cases_object),getCaseByNbr(4,5,all_cases_object),getCaseByNbr(5,5,all_cases_object)];

        /*const pos = [getCaseByNbr(3,4,all_cases_object),getCaseByNbr(2,5,all_cases_object),getCaseByNbr(3,5,all_cases_object),getCaseByNbr(4,5,all_cases_object)];

        const pos2 = generateBarPoss();
    
        invTobject = new InvTobject(positions=pos,color=default_invtobject_color,shape=0);
        invTobject.plantGrownd()

        carre2 = new Bar(positions=pos2);
        carre2.plantGrownd();

        all_obj.push(invTobject)
        all_obj.push(carre2)*/

        obj_move = generateRandomPiece();
        obj_move.plantGrownd();

        //setInterval(changeRot,300);

        setInterval(descendreObj,250);

    }
    
    function draw() {
      
        background(220)

        for(var i=0;i<all_cases_object.length;i++){

            const act_cs = all_cases_object[i];

            if(act_cs.isTaken){

                strokeWeight(2);
                stroke(0);

            } else {

                strokeWeight(1);
                stroke(195);

            }

            fill(act_cs.color[0],act_cs.color[1],act_cs.color[2])
            rect(act_cs.x,act_cs.y,act_cs.size,act_cs.size,act_cs.rounded)

        }

        for(var i=0;i<all_cases_object.length;i++){

            const act_cs = all_cases_object[i];

            if(act_cs.isTaken){

                strokeWeight(4);
                stroke(0);

            }
            
        }
        
    }
    
    


</script>